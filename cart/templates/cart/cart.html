{% extends "base.html" %}
{% block content %}

<div class="container py-4">

    <h2 class="mb-4 text-center">Your Cart</h2>

    {% if products %}
    <table class="table table-bordered align-middle shadow-sm">
        <thead class="table-dark">
            <tr>
                <th scope="col">Product</th>
                <th scope="col" class="text-center">Qty</th>
                <th scope="col" class="text-end">Price</th>
                <th scope="col" class="text-end">Subtotal</th>
                <th scope="col" class="text-center">Actions</th>
            </tr>
        </thead>

        <tbody>
            {% for item in products %}
            <tr>
                <td>
                    <strong>{{ item.product.name }}</strong><br>
                    <small class="text-muted">{{ item.product.description }}</small>
                </td>

                <td class="text-center">
                    <!-- Quantity Update Form -->
                    <form action="{% url 'update_cart' item.product.id %}" method="POST" class="d-inline-block">
                        {% csrf_token %}
                        <input type="number"
                               name="quantity"
                               value="{{ item.quantity }}"
                               min="1"
                               class="form-control w-50 d-inline-block text-center">
                        <button class="btn btn-sm btn-outline-dark mt-1" type="submit">Update</button>
                    </form>
                </td>

                <td class="text-end">£{{ item.product.price }}</td>
                <td class="text-end">£{{ item.subtotal }}</td>

                <td class="text-center">
                    <a href="{% url 'remove_from_cart' item.product.id %}"
                       class="btn btn-sm btn-danger">
                       Remove
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Cart Total -->
    <div class="text-end mt-4">
        <h3>Total: £{{ total }}</h3>
        <a href="{% url 'checkout' %}" class="btn btn-success btn-lg mt-3">
            Proceed to Checkout
        </a>
    </div>

    {% else %}

        <div class="text-center py-5">
            <h4>Your cart is currently empty.</h4>
            <a href="{% url 'products' %}" class="btn btn-dark mt-3">Browse Products</a>
        </div>

    {% endif %}

</div>

{% endblock %}